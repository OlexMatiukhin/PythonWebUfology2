<!-- templates/blog/post_detail.html -->
{% extends 'users/base_user.html' %}
{% block css %}
    <link rel="stylesheet" href="/static/css/post_detail.css">
{% endblock %}
{% block content %}
<div class="container mt-4">
    <h2>{{ post.title }}</h2>
    <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ post.author.username }}</p>
    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> {{ post.category }}</p>
    <p>{{ post.content }}</p>
    {% if post.preview_image %}
        <img src="{{ post.preview_image.url }}" alt="preview" class="img-fluid mb-3">
    {% endif %}
    <p>üëç {{ post.likes }} | üëé {{ post.dislikes }}</p>
    <hr>
{% if user.is_authenticated %}
    <form method="post" action="{% url 'users:posts:delete_post' post.id %}" style="margin-top: 15px;">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">–í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Å—Ç</button>
    </form>
{% endif %}


    <h4>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ ({{ comments.count }})</h4>
    {% for comment in comments %}
        <div class="border p-2 mb-2">
            <strong>{{ comment.author.username }}</strong>
            <small class="text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
            <p>{{ comment.text }}</p>

            {% if user.is_authenticated %}
                <form action="{% url 'users:posts:toggle_comment_like' comment.id %}" method="post" class="like-form"  style="display:inline;">
                {% csrf_token %}
                    <button type="submit" class="btn-outline-success">
                    üëç {{ comment.likes.count }}
                    </button>
                    </form>


                 <form action="{% url 'users:posts:toggle_comment_dislike'  comment.id %}" method="post"  class="dislike-form" style="display:inline;">
                 {% csrf_token %}
                     <button type="submit" class="btn-outline-danger">
                            üëé {{ comment.dislikes.count }}
                     </button>
                     </form>
            {% else %}
                <p>üëç {{ comment.likes.count }} | üëé {{ comment.dislikes.count }}</p>
                <hr>
            {% endif %}

        </div>
    {% empty %}
        <p>–ù–µ–º–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤.</p>
    {% endfor %}
    <hr>

    {% if user.is_authenticated %}
        <h5>–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä:</h5>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
        </form>
    {% else %}
        <p><a href="{% url 'users:login' %}">–£–≤—ñ–π–¥—ñ—Ç—å</a>, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä.</p>
    {% endif %}
</div>
{% endblock %}
